<!DOCTYPE html>
<html>
	<head>
		<title> My First Express App</title>

		<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">

		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">


  		<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  		<script type="text/javascript">
  			function select_all(){
  				if(document.getElementById('remove_all').checked==true){
  					console.log(document.getElementById('remove_all').checked);
  					for(var i=0;i<Number(document.getElementById('count').innerHTML);i++){
  						console.log(i)
  					document.getElementsByClassName('checkbox1')[i].checked=true;}
  				}else{
  					console.log(document.getElementById('remove_all').checked);
  					for(var i=0;i<Number(document.getElementById('count').innerHTML);i++){
  						console.log(i);
  					document.getElementsByClassName('checkbox1')[i].checked=false;}  				
  				}
  				add_data();
  			}
  			function check_checkbox(){
  				var c=1;
  				for(var i=0;i<Number(document.getElementById('count').innerHTML);i++){
  					if(document.getElementsByClassName('checkbox1')[i].checked==false){
  						document.getElementById('remove_all').checked=false;
  						c=0;
  						break;
  					}
  				}
  				if(c==1){
  					document.getElementById('remove_all').checked=true;
  				}
  				add_data();
  			}
  			function add_data(){
  				var data = '';
  				document.getElementById('link12').style.display='none';
  				for(var i=0;i<Number(document.getElementById('count').innerHTML);i++){
  					if(document.getElementsByClassName('checkbox1')[i].checked==true){
  						document.getElementById('link12').removeAttribute('style');
  						data+=document.getElementsByClassName('checkbox1')[i].name+',';
  					}
  				}
  				var year = document.getElementById('year').innerHTML;
				data = data.slice(0,data.length-1);
				data = data.split(',');
				var link = "/admin_remove_selected/?";
				for (i=0;i<data.length;i++){
					link+='data[]='+data[i]+'&';
				}
				link+="year="+year;
  				document.getElementById('link12').href=link;
  			}
			function searchName(){
				var mess = document.getElementById('search').value;
				if(mess!=''){
					var i=0;
					while(document.getElementsByClassName('studentName')[i]){
						if(document.getElementsByClassName('studentName')[i].innerHTML.indexOf(mess)!=-1 || String(document.getElementsByClassName('studentRno')[i].innerHTML).indexOf(mess)!=-1){
							document.getElementsByClassName('student_details')[i].style.display = '';
							// document.getElementsByClassName('student_details')[i].removeAttribute('style');
						}
						else{
							document.getElementsByClassName('student_details')[i].style.display = 'none';
						}
						i=i+1;
					}
				}
				else{
					var i=0;
					while(document.getElementsByClassName('studentName')[i]){
						document.getElementsByClassName('student_details')[i].style.display = '';
						// document.getElementsByClassName('student_details')[i].removeAttribute('style');
						i=i+1;
					}
				}
			}
  		</script>
	</head>
	<body>
		<nav>
			<a href="/admin_home" class="active">Home</a>
			<a href="/admin_change_details">Manage</a>
			<a href="/admin_profile">Profile</a>
		</nav>
		<h1>Hello <%=user%></h1>
		<form method="post">
			<p>Year of admission: <input type="number" name="year" required="true" /></p>
			<p><input type="submit" name="submit" value="submit"></p>
		</form>
		<% if(typeof students!='undefined'){%>
			<h4>Year of admission: <%=year%></h4>
			<form method='post'><p>Search: <input type="text" name="search" id='search' onkeyup="searchName()" placeholder="Search for name or rollno" /></p></form>	
			<table>
				<tr>
					<th>Select All<form method="post"><span><input type="checkbox" name="a" id="remove_all" style="opacity: 1; pointer-events: visible;" onclick='select_all()'></span></form></th>
					<th>Name</th><th>Roll No</th><th>Hostel Name</th><th>Room No</th><th>Branch Name</th><th>Email ID</th><th>Phone No</th><th>Total Attendance</th><th>Update details</th><th>Remove Student</th></tr>
				<% var keys = Object.keys(students)%>
				<% var count = 0;%>
				<p style="display: none;" id="year"><%=year%></p>
				
				<% keys.forEach(function(key){ %>
				<tr class="student_details">
					<form method="post"><td><p><input type="checkbox" style="opacity: 1; pointer-events: visible;" class="checkbox1" onclick="check_checkbox()" name="<%=key%>"></p></td></form>
					<%count = count+1;%>
					<td class="studentName"><%=(students[key].Name)%></td>
					<td class="studentRno"><%=(key)%></td>
					<td><%=(students[key].HostelName)%></td>
					<td><%=(students[key].RoomNo)%></td>
					<td><%=(students[key].BranchName)%></td>
					<td><%=(students[key].EmailID)%></td>
					<td><%=(students[key].PhoneNo)%></td>
					<td><%=(students[key].TotalAttendance)+'/'+total_days%></td>
					<% var link1 = '/admin_change/?id='+key+'&year='+year%>
					<td><a href="<%=link1%>"><button>Update</button></a></td>
					<% var link = '/admin_remove/?id='+key+'&year='+year%>
					<td><a href="<%=link%>"><button>Remove</button></a></td>
				</tr>
					<%});%>
			</table><br/>
			<p id="count" style="display: none;"><%=count%></p>
			<%if(typeof abc!='undefined'){%>
			<form method="post"><p style="display: none;"><input type="text" id='data' name="data" value=''></p></form>
			<%}%>
			
		
		<%}%>
		<%if(typeof error!='undefined'){%>
			<p style="color: red;"><%=error%></p>
		<%}%>
		<a id="link12" href="" style="display: none;"><button>Remove Selected</button></a>
		<br/>
		<a href="/admin_add_choice"><button>Add Students</button></a>
	</body>
</html>
